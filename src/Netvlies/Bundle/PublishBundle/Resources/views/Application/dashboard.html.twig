{% extends 'NetvliesPublishBundle::layout.html.twig' %}
{% block oms_project_name %}{{application.name}}{% endblock %}

{% block content %}

    <div id="content-wrapper">

        <section id="content">
            <header>
                <h1>{{application.name}}</h1>
                <a href="{{ path('netvlies_publish_application_edit', {'id': application.id}) }}">[ edit ]</a>
            </header>
            <hr />
            <div id="text">

            Customer: {{application.customer}}<br>
            Name: {{application.name}}<br>
            Repository type: {{application.scmService}}<br>
            Applicationtype: {{application.applicationtype|apptypelabel}}<br>
            <br><br>

            {% if application.targets | length > 0%}

                <h2>Currently deployed versions</h2>
                <table border="1" cellspacing="0">
                <thead>
                    <th>O</th>
                    <th>T</th>
                    <th>A</th>
                    <th>P</th>
                </thead>
                <tr>
                    {% set types = ['O', 'T', 'A', 'P'] %}
                    {% for type in types %}
                    <td>
                        {% for target in application.targets if target.environment.type == type and target.inactive is empty %}
                            {% if not loop.first %}
                            <hr>
                            {%endif%}
                            <a href="{{ path('netvlies_publish_target_edit', { 'id': target.id}) }}">{{target.label}}</a><br>
                            {%if target.lastDeployedBranch is not empty%}
                                {{ target.lastDeployedBranch}}<br>
                            {%else%}
                                Not yet deployed<br>
                            {%endif%}
                        {% endfor %}
                    </td>
                    {%endfor%}
                </table>

            {%endif%}
            <br>

                <h2>Last executed commands</h2>
                <table border="1" cellspacing="0">
                    <thead>
                        <th>Date</th>
                        <th>Command type</th>
                        <th>Target</th>
                        <th>User</th>
                        <th>Status</th>
                        <th>Log</th>
                    </thead>
                    {% for log in logs %}
                        <tr>
                            <td>
                                {{ log.datetimestart.format('d-m-Y H:i') }}
                            </td>
                            <td>{{ log.commandLabel }}</td>
                            <td>
                                {% if log.target is not null %}
                                    {{ log.target.label }}
                                {% else %}
                                    {{ log.host }}
                                {% endif %}
                            </td>
                            <td>
                                {{ log.user }}
                            </td>
                            <td>
                                {% if log.exitcode == 0 %}
                                    success
                                {% else %}
                                    failed
                                {% endif %}
                            </td>
                            <td>
                                <a href="{{ path('netvlies_publish_command_viewlog', {'id': log.id, 'application': application.id}) }}">View log</a>
                            </td>
                        </tr>
                    {% endfor %}
                    <tr>
                        <td colspan="5" align="right">&nbsp;</td>
                        <td><a href="{{ path('netvlies_publish_command_listlogs', {'id': application.id}) }}">View all logs</a></td>
                    </tr>
                </table>


            </div>
        </section>
    </div>


{% endblock %}