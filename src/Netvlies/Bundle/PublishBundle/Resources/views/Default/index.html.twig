{% extends 'NetvliesPublishBundle::layout.html.twig' %}

{% block content_wrapper %}
    <h3>Dashboard</h3>
    <hr>

    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">Top Applications</h3>
        </div>
        <div class="panel-body">

            {% if apps|length > 0 %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        {% for app in favourites %}
                            <tr>
                                <td><a href="{{ path('netvlies_publish_application_dashboard', {'application': app.id }) }}">{{ app.name }}</a></td>
                            </tr>
                        {% endfor %}
                    </table>
                </div>
            {% else %}
                Oops! There are no applications present. Try adding one with the button below.
                <br>
                <br>
                <a href="{{path('netvlies_publish_application_create')}}" class="btn btn-default">Add new application</a>
            {% endif %}

        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">Top deployers</h3>
        </div>
        <div class="panel-body">
            <ul class="list-group">
                <li class="list-group-item">Sjoerd - 34</li>
                <li class="list-group-item">Harry - 6</li>
            </ul>
        </div>
    </div>


    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">Latest Deployments</h3>
        </div>
        <div class="panel-body">

            {% if logs|length > 0 %}
                <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Command type</th>
                                <th>Application</th>
                                <th>Commit</th>
                                <th>Target</th>
                                <th>User</th>
                                <th>Status</th>
                                <th>Log</th>
                            </tr>
                        </thead>

                        {% for log in logs %}
                            <tr
                                {% if log.exitcode is null %}
                                    class="warning"
                                {% elseif log.exitcode == 0 %}
                                    class="success"
                                {% else %}
                                    class="danger"
                                {% endif %}
                                >
                                <td>
                                    {#{{ log.datetimestart.format('d-m-Y H:i') }}#}
                                    {{ log.datetimestart|timediff }}
                                </td>
                                <td>{{ log.commandLabel }}</td>
                                <td>
                                    <a href="{{ path('netvlies_publish_application_dashboard', {'application': log.application.id }) }}">{{ log.application.name }}</a>
                                </td>
                                <td>
                                    {% if log.commitUrl %}
                                        <a href="{{ log.commitUrl }}" target="_blank">{{ log.commitHash }}</a>
                                    {% else %}
                                        {{ log.commitHash }}
                                    {% endif %}
                                </td>
                                <td>
                                    {% if log.target is not null %}
                                        {{ log.target.label }}
                                    {% else %}
                                        {{ log.host }}
                                    {% endif %}
                                </td>
                                <td>
                                    {{ log.user }}
                                </td>
                                <td>
                                    {% if log.exitcode is null %}
                                        <img src="{{ asset('bundles/netvliespublish/img/ajax-loader.gif') }}">
                                    {% elseif log.exitcode == 0 %}
                                        success
                                    {% else %}
                                        failed
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{{ path('netvlies_publish_command_viewlog', {'commandlog': log.id }) }}">View log</a>
                                </td>
                            </tr>
                        {% endfor %}
                    </table>
                </div>
            {% else %}
                <p>No applications have been deployed yet.</p>
            {% endif %}

        </div>
    </div>

{% endblock %}
